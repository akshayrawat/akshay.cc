<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html class='no-js' lang='en'>
  <!-- <![endif] -->
  <head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <meta content='Home of Akshay Rawat' name='description' />
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <title>Akshay Rawat</title>
    <link href='humans.txt' rel='author' />
    <link href="/css/application.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body class='blog'>
    <!--[if lt IE 7]> <p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p> <![endif]-->
    <div id='top-bg'></div>
    <div class='container-fluid' id='page'>
      <div class='row-fluid'>
        <aside class='span3' id='sidebar'>
          <h1 id='logo'>
              <a href="/"><img src="/img/logo.png" /></a>
          
          </h1>
          <nav id='main-nav'>
            <ul>
              <li class='inactive'>
                <a href="/">Blog</a>
              </li>
              <li class='inactive'>
                <a href="/projects">Projects</a>
              </li>
              <li class='inactive'>
                <a href="/experiments">Experiments</a>
              </li>
            </ul>
          </nav>
          <div id='social'>
            <ul>
              <li>
                      <a href="http://www.twitter.com/akshayrawat"><i class='icon-twitter'></i>
                </a>
          
              </li>
              <li>
                      <a href="http://www.github.com/akshayrawat"><i class='icon-github'></i>
                </a>
          
              </li>
              <li>
                      <a href="http://in.linkedin.com/pub/akshay-rawat/11/93/807"><i class='icon-linkedin'></i>
                </a>
          
              </li>
              <li>
                      <a href="mailto:projects@akshay.cc?subject=Hi%20There!"><i class='icon-envelope'></i>
                </a>
          
              </li>
            </ul>
          </div>
        </aside>
        <section class='span9' id='main'>
          <div class='page-title'>
  <h2>
    <div class='pull-left'>
      Moved to BackboneJS and JQuery templates
    </div>
    <div class='pull-right'>
      Oct 28 2010
    </div>
  </h2>
</div>
<div class='blog-body'>
  <p>I had been planning to move DirectoryOfMinisters to Javascript for sometime now. It is a simple directory to find information on Members of Parliament from various states in India. It was based on a Sinatra backend which consumed data served by an API with Haml,Sass for view goodness.
The options I evaluated were SproutCore, Cappuccino and Backbonejs. I did think too much about JQuery Data bindings, because I wanted to explore an MVC solution to building a frontend, albeit a simple one. I finally went with Backbonejs because it was the lightest thing I could use and the fastest to implement (for me). The only features which I really wanted were - JSON backed models, Javascript templating, the ability to listen to events for model modifications and a basic structure to organizing JS code.
To get an idea of how simple this application is, visit <a href="http://directory.myminister.info">http://directory.myminister.info</a>. Here is a brief on how the code looks.</p>

<p>The main page of the app is index.html, it just loads all the JS files in app.
index.html
index.html
&lt;script src=&quot;/js/mpprofile.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/mps.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/states.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/init.js&quot;&gt;&lt;/script&gt;
Each javascript file here represents a view. init.js starts up the app by initializing the first view.
init.js
$(document).ready(function(){
  new StateView();
});
Now when a StatesView is initialized, it creates a new States collection. The States initializer knows how to get the data to initialize the State model.</p>

<p>states.js
var StateView = Backbone.View.extend({
  id: &#39;states&#39;,</p>

<p>events: {
    &quot;click #states table tr[id]&quot;: &quot;stateSelected&quot;
  },</p>

<p>initialize: function(){
    this.states = new States();
    this.states.bind(&#39;refresh&#39;, this.refresh);
  }
}
states.js
var States  = Backbone.Collection.extend({
  model: State,
  initialize: function(){
    var that = this;
    $.ajax({
      url : Config.api_host + &#39;/states.json&#39;,
      dataType : &quot;jsonp&quot;,
      success : function (data, status, xhr) {
      that.refresh($.parseJSON(data.model));
    }
  }
});</p>

<p>In this case we make a jsonp request to get data from a different subdomain. The view listens to the refresh event on the collection. refresh is used to initialize the collection with the model json. After refresh happens, we get the JQuery template for the view and bind the data to it.</p>

<p>states.js
render: function() {
  var that = this;
  $.get(&#39;/html/_states.tpl.html&#39;, function(statesTemplate) {
    this.$(this.el).html($.tmpl(statesTemplate, {stateList: this.states.models}););
    $(&quot;#col-1&quot;).html(this.el);
  });
  return this;
}</p>

<p>And we have our first page. Now, when a state is selected, the handler stateSelectedbound to the state row creates a new MPView.</p>

<p>states.js
stateSelected: function(event){
  new MPView({stateId: event.currentTarget.id});
}</p>

<p>The MPView initialization again initializes the Collection first, which knows which url to get the data from. In this case we get all the ministers for the state id.
The full source code for this app is here. I&#39;m still in the process of improving it as I get more fimilar with Backbonejs. 
Having said that, there are 2 things I wish BackboneJS would do better.
Usually a Collection can define its source url like this
var Notes = Backbone.Collection.extend({
  url: &#39;/notes&#39;
});
This is very nice indeed, except that it doesn&#39;t work when the datatype is jsonp. Then one has to drop down to jquery to make a jsonp ajax call to get the data.
A view can listen to events on UI elements like this</p>

<p>var DocumentRow = Backbone.View.extend({
  tagName: &quot;li&quot;,
  className: &quot;document-row&quot;,
  events: {
    &quot;click .button.edit&quot;:   &quot;openEditDialog&quot;
  }
}
Nice again. Here this is bound to the view. This is very handy indeed unless you want to know which element was clicked. In which case I had to resort to using JQuery&#39;s click , which sets the this to the clicked element.
Some examples on unit testing BackboneJS MVC would also be nice.
Now back to exploring some server side js !</p>

<p>Update: The code kludge with binding events (complaint no. 2) is gone based on this comment from <a href="mailto:Jeremy@DocumentCloud">Jeremy@DocumentCloud</a>. The example above is corrected.</p>
</div>
        </section>
      </div>
      <div id='page-footer'></div>
    </div>
    <footer>
      Made with Middleman &bull; Hosted on Github
    </footer>
  </body>
</html>

