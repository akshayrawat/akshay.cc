<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html class='no-js' lang='en'>
  <!-- <![endif] -->
  <head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <meta content='Home of Akshay Rawat' name='description' />
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <meta description='Works of Akshay Rawat' />
    <link href='/apple-touch-icon.png' rel='apple-touch-icon' />
    <link href='/favicon.ico' rel='shortcut icon' />
    <title>
      Control flow differences between Ruby Procs and Lambdas.
    </title>
    <link href='humans.txt' rel='author' />
    <link href="/css/application.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" media="screen" rel="stylesheet" type="text/css" />
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-33977928-1']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
  </head>
  <body class='blogs'>
    <!--[if lt IE 7]> <p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p> <![endif]-->
    <div id='top-bg'></div>
    <div class='container-fluid' id='page'>
      <div class='row-fluid'>
        <div class='span3'>
          <aside id='sidebar'>
            <h1 id='logo'>
                <a href="/"><i class='icon-external-link'></i>
              </a>
            
            </h1>
            <nav id='main-nav'>
              <ul>
                <li class='active'>
                  <a href="/">Blog</a>
                </li>
                <li class='inactive'>
                  <a href="/projects/">Projects</a>
                </li>
                <li class='inactive'>
                  <a href="/experiments/">Experiments</a>
                </li>
              </ul>
            </nav>
            <div id='social'>
              <ul>
                <li>
                        <a href="http://www.twitter.com/akshayrawat"><i class='icon-twitter'></i>
                  </a>
            
                </li>
                <li>
                        <a href="http://www.github.com/akshayrawat"><i class='icon-github'></i>
                  </a>
            
                </li>
                <li>
                        <a href="http://in.linkedin.com/pub/akshay-rawat/11/93/807"><i class='icon-linkedin'></i>
                  </a>
            
                </li>
                <li>
                        <a href="mailto:projects@akshay.cc?subject=Hi%20There!"><i class='icon-envelope'></i>
                  </a>
            
                </li>
              </ul>
            </div>
          </aside>
        </div>
        <div class='span9'>
          <section id='main'>
            <div class='page-title'>
  <h2>
    <div class='pull-left'>
      Control flow differences between Ruby Procs and Lambdas.
    </div>
    <div class='pull-right'>
      Feb 14 2010
    </div>
  </h2>
</div>
<div class='blog-body'>
  <p>One of the main differences between Procs and Lambdas in Ruby is how they work with <code>return</code> and <code>break</code>statements. The key to understanding this will make you opt for one control flow over the other.</p>

<h4>Return</h4>

<p>A <code>proc</code> <code>return</code> returns the control flow from their lexical scope. The lexical scope of a proc is the function in which its defined. Its determined statically when Ruby parses code.</p>

<p>Whereas a <code>lambda</code> <code>return</code> returns the control flow to its execution scope. This is just like a <code>return</code> from a method call. Control flow resumes to the line after the method call.</p>

<p>Example:</p>
<div class="highlight "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre>  describe &quot;control flow&quot; do
    class ReturnBehavior
      def self.call_proc
        proc { return &quot;return-a&quot; }.call
        &quot;return-b&quot;
      end
      def self.call_lambda
        lambda { return &quot;return-a&quot; }.call
        &quot;return-b&quot;
      end
    end
    it &quot;shows procs return from their lexical scope&quot; do
      ReturnBehavior.call_proc.should == &quot;return-a&quot;
    end
    it &quot;shows lambdas return returns to their execution scope&quot; do
      ReturnBehavior.call_lambda.should == &quot;return-b&quot;
    end
  end</pre></td>
</tr></table>
</div>
<p>A <code>LocalJumpError</code> occurs when the lexical scope of a <code>proc</code> has already returned, and then the <code>proc</code> calls <code>return</code>.</p>

<p>For example below, the method <code>a_proc</code> builds and returns a <code>proc</code>. At the point the lexical scope has already returned, i.e. <code>a_proc</code> has already returned. Now when this returned <code>proc</code> is invoked via <code>call</code> (on line 11), it tries to return there is nothing to return out of, and hence the <code>LocalJumpError</code></p>
<div class="highlight "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>  describe &quot;local jump errors &quot; do
    class LocalJumpReturnBehavior
      def self.a_proc
        proc { return }
      end
      def self.a_lambda
        lambda { return }
      end
    end
    it &quot;shows procs raise LocalJumpError when the lexical scope has already returned&quot; do
      lambda { LocalJumpReturnBehavior.a_proc.call }.should raise_error(LocalJumpError)
    end
    it &quot;shows lambdas do not raise LocalJumpError when the lexical scope has already returned&quot; do
      lambda { LocalJumpReturnBehavior.a_lambda.call }.should_not raise_error(LocalJumpError)
    end
  end</pre></td>
</tr></table>
</div>
<h4>Break</h4>

<p>The key difference here is that a <code>proc</code> needs an enclosing block to <code>break</code> out of, where as a <code>lambda</code> does not.</p>
<div class="highlight "><div class="ribbon"></div><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
26
</pre></td>
  <td class="code"><pre>describe &quot;break&quot; do
  describe &quot;local jump errors on break&quot; do
    class LocalJumpBreakBehavior
      def self.a_proc
        proc { break }
      end
      def self.call_proc
        proc { loop { break } }.call
        &quot;return-b&quot;
      end
      def self.call_lambda
        lambda { break }.call
        &quot;return-b&quot;
      end
    end
    it &quot;shows procs raise LocalJumpError when no enclosing block&quot; do
      lambda { LocalJumpBreakBehavior.a_proc.call }.should raise_error(LocalJumpError)
    end
    it &quot;shows procs break if in an enclosing block&quot; do
      LocalJumpBreakBehavior.call_proc.should == &quot;return-b&quot;
    end
    it &quot;shows lambdas break even if not in an enclosing block&quot; do
      LocalJumpBreakBehavior.call_lambda.should == &quot;return-b&quot;
    end
  end
end</pre></td>
</tr></table>
</div>
<h4>Reads</h4>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Scope_(computer_science)#Lexical_scoping_and_dynamic_scoping">Lexical and Dynamic Scoping</a></li>
</ul>
</div>
<div class='comments'>
  <div id='disqus_thread'></div>
  <script type='text/javascript'>
    //<![CDATA[
      var disqus_shortname = 'akshaycc';
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    //]]>
  </script>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
          </section>
        </div>
      </div>
      <div id='page-footer'></div>
    </div>
    <footer>
      Made with Middleman &bull; Hosted on Github
    </footer>
  </body>
</html>

